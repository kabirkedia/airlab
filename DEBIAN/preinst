ARCH=$(uname -m)

## For Docker
DOCKER_LIST="/etc/apt/sources.list.d/docker.list"

# Check if Docker's repository already exists
if [ ! -f "$DOCKER_LIST" ]; then
    echo "Adding Docker's official repository for architecture $ARCH..."
    echo "deb [arch=$ARCH signed-by=/usr/share/keyrings/docker-archive-keyring.gpg] https://download.docker.com/linux/ubuntu $(lsb_release -cs) stable" | \
        sudo tee "$DOCKER_LIST" > /dev/null
else
    echo "Docker's repository already exists. Skipping..."
fi

## For Nvidia-container-toolkit
NVIDIA_LIST="/etc/apt/sources.list.d/nvidia-container-toolkit.list"

# Check if Nvidia-container-toolkit's repository already exists
if [ ! -f "$NVIDIA_LIST" ]; then
    echo "Adding Nvidia-container-toolkit's repository..."
    curl -s -L https://nvidia.github.io/libnvidia-container/stable/deb/nvidia-container-toolkit.list | \
        sed 's#deb https://#deb [signed-by=/usr/share/keyrings/nvidia-container-toolkit-keyring.gpg] https://#g' | \
        sudo tee "$NVIDIA_LIST" > /dev/null
else
    echo "Nvidia-container-toolkit's repository already exists. Skipping..."
fi

# Ensure pip3 is available
echo "Checking for pip3..."
PIP_PATH=$(which pip3)
if [ ! -x "$PIP_PATH" ]; then
    echo "pip3 is not installed. Aborting."
    exit 1
fi

# List of PIP packages to install
PIP_PACKAGES="pyyaml"

echo "Installing PIP packages..."
for pkg in $PIP_PACKAGES; do
    if ! pip3 show "$pkg" &>/dev/null; then
        echo "Installing $pkg..."
        pip3 install "$pkg"
    else
        echo "$pkg is already installed."
    fi
done

echo "All dependencies have been installed successfully."
